!function(){"use strict";var k,C,w,t=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),E=tinymce.util.Tools.resolve("tinymce.util.I18n"),A="forecolor",n=["#fff","#efeff4","#e5e5ea","#d1d1d6","#c7c7cc","#3f4a56","#4a4a4d","#000000","#ff3b30","#ff9500","#ffcc00","#4cd964","#5ac8fa","#007aff","#5856d6","#bd10e0","#ffd8d6","#ffeacc","#fff5cc","#dbf7e0","#def4fe","#cce4ff","#deddf7","#f2cff9","#ffb1ac","#ffd599","#ffeb99","#bff1c7","#bde9fd","#99caff","#bcbbef","#e59ff3","#ff766f","#ffb54d","#ffdb4d","#82e493","#8cd9fc","#4da2ff","#8a89e2","#d158e9","#b22922","#b26800","#b28e00","#359746","#3f8caf","#0055b2","#3d3c95","#840b9c","#661813","#663c00","#665200","#1e5728","#245064","#003166","#232256","#4c065a"];function S(t){var e=t.getBoundingClientRect();return{left:e.x,top:e.y+e.height+3}}var o,T=(o={forecolor:"#ff3b30",hilitecolor:"#ffcc00"},{get:function(t){return o[t]},set:function(t,e){o[e]=t}}),L=function(t){var e,o=(e=n.length,Math.max(5,Math.ceil(Math.sqrt(e))));return r(t,o)},r=function(t,e){return t.getParam("color_cols",e,"number")},c=function(t,e,o){var n,r;n="forecolor"===e?"tox-icon-text-color__color":"tox-icon-highlight-bg-color__color",r=o,t.setIconFill(n,r),t.setIconStroke(n,r)},l=function(t){return function(){return t}},B=function(t,e){return t.fire("TextColorChange",e)},e=function(e){return{getOr:l(e),each:function(t){t(e)},bind:function(t){return t(e)},toString:function(){return"some("+e+")"}}},a=function(){return f},f={getOr:function(t){return t},each:function(){},bind:a,toString:l("none()")},d=e,u=a,s=function(t){return null===t||t===undefined?f:e(t)},p=function(t,e,o,n){n(o),t.execCommand("mceApplyTextcolor",e,o)},I=function(i){return function(t,e){var o,n={colorpicker:e},r=(o=t,function(t){i.fire("showDialogTitle");var e=t.getData();o(s(e.colorpicker)),t.close()});i.windowManager.open({title:"Color Picker",size:"normal",body:{type:"panel",items:[{type:"colorpicker",name:"colorpicker",label:"Color"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:n,onAction:function(t,e){"hex-valid"===e.name&&(e.value?t.enable("ok"):t.disable("ok"))},onSubmit:r,onClose:function(){},onCancel:function(){t(u()),i.fire("showDialogTitle")}})}},M=function(t){g.add(t)},g=function(t){var r=t;void 0===r&&(r=8);return{add:function(t){var e,o=D("forecolor"===A?"choose-colors":"back-colors"),n=r-(e=o).length<0?e.slice(0,r):e;m(n,t).each(function(t){n.splice(t,1)}),n.unshift(t),n.length>r&&n.pop(),i.setItem("forecolor"===A?"choose-colors":"back-colors",JSON.stringify(n))}}}(10),m=function(t,e){var o=x(t,e);return-1===o?u():d(o)},x=function(t,e){return h.call(t,e)},h=Array.prototype.indexOf;function _(t,o){var e=t.target;"I"===e.tagName&&(e=e.parentNode),e.style.background&&p(w,o,e.style.background,function(t){var e=z(t);T.set(e,A),M(e),B(w,{name:o,color:e})})}function D(t){var e=i.getItem(t);return"string"==typeof e?JSON.parse(e):[]}function N(){var t=document.getElementById("menu-dropdown");t&&t.parentNode.removeChild(document.getElementById("menu-dropdown"))}function z(t){if(t&&0<=t.indexOf("#"))return t;for(var e=t.toString().match(/\d+/g),o="#",n=0;n<3;n++)o+=("0"+Number(e[n]).toString(16)).slice(-2);return o}function b(n,t,r){N();for(var i=(i=T.get(A))&&z(i),o=t.map(function(t,e){var o=document.createElement("div");return o.setAttribute("style","background: "+t+"; margin:3px 3px; width: 16px; height: 16px;border-radius: 2px; cursor: pointer;display: inline-block"),0===e&&(o.style.border="1px solid #e8e8e8",o.style.boxSizing="border-box"),i===t&&(o.style.position="relative"),o.innerHTML='<i style="border-right: 2px solid white;\nborder-top: 2px solid white;transform: rotate(132deg);position: absolute;top: 3px;left: 3px;height: 4px;width: 7px;display: block;"></i>',o}),c=L(n),l=document.createElement("div"),e=0;e<c&&o.length;e++)!function(t){var e=document.createElement("div");o.splice(0,c).forEach(function(t){e.appendChild(t)}),e.setAttribute("style","text-align: center; height: 22px"),0!==t&&1!==t||(e.style.margin="4px 0"),e.addEventListener("click",function(t){_(t,r)}),l.appendChild(e)}(e);var a=D("forecolor"===A?"choose-colors":"back-colors"),f=document.createElement("div");f.innerHTML='<h3 style="font-size: 12px; color: #8091a5;font-weight: normal;margin: 0 3px 7px">'+E.translate("History Color")+"</h3>",f.setAttribute("style","padding: 5px 13px;");var d=document.createElement("div");d.style.textAlign="center";for(var u=0;u<c&&a.length;u++){var s=document.createElement("div");s.setAttribute("style","background: "+a[u]+"; margin:3px 3px 5px; width: 16px; height: 16px;border-radius: 2px; cursor: pointer;display: inline-block"),d.appendChild(s)}d.addEventListener("click",function(t){_(t,r)}),f.appendChild(d),l.appendChild(f);var p=document.createElement("div");p.innerHTML='<h3 style="font-size: 12px; font-weight: normal;margin: 0;cursor: pointer;">'+E.translate("Custom color")+'</h3><svg style="height: 12px;width: 12px;color: #8091a5;" version="1.1" id="\u56fe\u5f62" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="90.288 58.809 850.394 850.394" enable-background="new 90.288 58.809 850.394 850.394" xml:space="preserve">\n<g>\n\t<path d="M322.498,909.202c-7.622,0-15.245-2.886-21.093-8.668c-11.781-11.649-11.888-30.645-0.238-42.426l368.318-372.482\n\t\tL297.962,109.903c-11.65-11.782-11.543-30.776,0.238-42.426c11.783-11.649,30.777-11.542,42.426,0.238l392.381,396.817\n\t\tc11.558,11.688,11.558,30.5,0,42.188L343.831,900.296C337.964,906.23,330.232,909.202,322.498,909.202z"/>\n</g>\n</svg>',p.setAttribute("style","padding: 10px 13px; border-top: 1px solid #C5D7EF;display: flex;align-items: center;justify-content: space-between;"),p.addEventListener("click",function(){var e,o;n.fire("disableDialogTitle"),e=function(t){var e=z(t);T.set(e,A),B(n,{name:r,color:e})},o=r,I(w)(function(t){t.each(function(t){M(t),w.execCommand("mceApplyTextcolor",o,t),e(t)})},"#000000")}),l.appendChild(p);var g,m,x,h,b,v,y=(m="forecolor"===r?"tox-icon-text-color__color":"tox-icon-highlight-bg-color__color",!(x=null===(g=document.querySelector("#"+m))||void 0===g?void 0:g.closest(".tox-split-button"))||x.closest(".tox-editor-header")?{left:k,top:C}:S(x));l.setAttribute("style","top: "+y.top+"px; left: "+y.left+"px;background: white; z-index: 2000; width: 202px; border: 1px solid #C5D7EF; box-shadow: 0 6px 12px rgba(0,0,0,0.09); padding: 5px 0; position: absolute"),l.setAttribute("id","menu-dropdown"),document.body.appendChild(l),b=(h=l).getBoundingClientRect(),v=document.body.getBoundingClientRect().right-8,b.right>v&&(h.style.left=b.left-(b.right-v)+"px")}var v,y,O=function(t,e){b(t,n,A=e),t.on("click",function(){N()})},H=function(o,t,e){p(o,A,e,function(t){var e=z(t);T.set(e,A),B(o,{name:name,color:e})})},F=function(t,e,o){(w=t).editorContainer.getElementsByClassName("tox-editor-header")[0].addEventListener("click",function(t){var e,o=t.target.closest(".tox-split-button");o&&(e=S(o),k=e.left,C=e.top),N()}),c(e,o,T.get(o));var n=function(t){c(e,t.name,T.get(t.name))};return t.on("TextColorChange",n),function(){t.off("TextColorChange",n)}},P=function(t,e){A=e,null!==T.get(A)&&p(t,e,T.get(A),function(){})};v="hilitecolor",y="forecolor",t.add("cherry-colorpicker",function(o){document.body.addEventListener("click",N),o.ui.registry.addSplitButton("ch-text-color",{icon:"color-picker-text",tooltip:"Text Colour",columns:L(o),fetch:function(){O(o,y)},onAction:function(t){P(o,y)},onItemAction:function(t,e){H(o,0,e)},onSetup:function(t){F(o,t,y)}}),o.ui.registry.addSplitButton("ch-back-color",{icon:"color-picker-back",tooltip:"Background Colour",columns:L(o),fetch:function(){O(o,v)},onAction:function(t){P(o,v)},onItemAction:function(t,e){H(o,0,e)},onSetup:function(t){F(o,t,v)}})})}();