!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),o='\n<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M12.9946 3.71637L12.9946 6.51441C12.9946 6.79055 13.2185 7.01441 13.4946 7.01441C13.7708 7.0144 13.9946 6.79055 13.9946 6.5144L13.9946 3.0144C13.9946 2.46212 13.5469 2.0144 12.9946 2.0144H9.49463C9.21849 2.0144 8.99463 2.23826 8.99463 2.5144C8.99463 2.79055 9.21849 3.0144 9.49463 3.0144L12.2824 3.0144L8.93648 6.36035C8.74122 6.55562 8.74122 6.8722 8.93649 7.06746C9.13175 7.26272 9.44833 7.26272 9.64359 7.06745L12.9946 3.71637Z" fill="#182B50"/>\n<path d="M2.01904 12.9883C2.01904 13.5406 2.46676 13.9883 3.01904 13.9883L6.51904 13.9883C6.79519 13.9883 7.01904 13.7644 7.01904 13.4883C7.01904 13.2121 6.79519 12.9883 6.51904 12.9883L3.77304 12.9883L7.09758 9.66386C7.29285 9.46861 7.29286 9.15202 7.0976 8.95676C6.90234 8.76149 6.58576 8.76149 6.39049 8.95674L3.01904 12.3281L3.01904 9.48828C3.01904 9.21214 2.79519 8.98828 2.51904 8.98828C2.2429 8.98828 2.01904 9.21214 2.01904 9.48828V12.9883Z" fill="#182B50"/>\n</svg>\n',n='\n    <div class="tapd-grap-dialog__mask">\n    <div class="tapd-grap-dialog__content">\n        <div class="tapd-grap-dialog__head clearfix">\n            <span class="tapd-grap-dialog__head-title">\u63d2\u5165\u753b\u56fe</span>\n            <span class="tapd-grap-dialog__head-close j-close-dialog"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M4.35355 3.64645C4.15829 3.45118 3.84171 3.45118 3.64645 3.64645C3.45118 3.84171 3.45118 4.15829 3.64645 4.35355L7.29314 8.00024L3.64645 11.6469C3.45118 11.8422 3.45118 12.1588 3.64645 12.354C3.84171 12.5493 4.15829 12.5493 4.35355 12.354L8.00024 8.70735L11.6464 12.3536C11.8417 12.5488 12.1583 12.5488 12.3536 12.3536C12.5488 12.1583 12.5488 11.8417 12.3536 11.6464L8.70735 8.00024L12.3539 4.35374C12.5491 4.15848 12.5491 3.8419 12.3539 3.64663C12.1586 3.45137 11.842 3.45137 11.6467 3.64663L8.00024 7.29314L4.35355 3.64645Z" fill="#182B50"/>\n</svg>\n</span>\n            <span class="tapd-grap-dialog__head-fullscreen j-set-dialog-size">'+o+'</span>\n        </div>\n        <div class="tapd-grap-dialog__body">\n            <div class="tapd-grap-dialog__body--loading j-dialog-loading" style="display: block;">\n               <div class="tapd-grap-dialog__body--loading_icon strip-loading2"></div>\n            </div>\n            <iframe style="visibility: visible;" allowtransparency="true" id="tapd-grap-dialog-iframe" src="TAPD_GRAP_URL" width="100%" frameborder="0" height="100%" loaded="true"></iframe>\n        </div>\n        <div class="tapd-grap-dialog__foot">\n        <div class="tapd-grap-dialog__foot-btns">\n            <span class="foot-btn foot-btn__ensure j-foot-btn__ensure">\u786e\u5b9a</span>\n            <span class="foot-btn foot-btn__cancel j-close-dialog">\u53d6\u6d88</span>\n        </div>\n        </div>\n    </div>\n    </div>\n';function e(){var e=this;this.target=null,this.editor=null,this.created=!1,this.dialogVisble=!1,this.handlers={},window.addEventListener("message",function(t){if(t.data&&t.data.eventName&&e.target)switch(t.data.eventName){case"GET_GRAP_DATA:SUCCESS":e.onSure(e.encodeXml(t.data.value.xmlData),t.data.value.base64);break;case"INIT_GRAP:SUCCESS":document.querySelector(".j-tapd-grap-dialog .j-dialog-loading").style.display="none"}},!1)}var a=new(e.prototype.init=function(t){this.editor=t,this.drawioUrl=t.getParam("cherry_drawio_url","")},e.prototype.onSure=function(t,o){var i=this,r=this,d=this.target;this.beforeInsertXML(t,function(e,a){void 0===a&&(a="");var t=i.editor.getParam("images_upload_handler",null);function n(){document.querySelector(".j-tapd-grap-dialog").style.display="none";var t=r.getParam("graph_save_failed",null);"function"==typeof t&&t(r.target),r.target=null,r.editor.fire("closeCustomDialog")}t?t({base64:function(){return o}},function(t){d.setAttribute("src",t),d.setAttribute("data-mce-src",t),d.setAttribute("data-origin-xml",e),d.setAttribute("data-graph-oldxml",""),d.setAttribute("data-graph-oldsrc",""),d.setAttribute("data-graph-token",a),d.setAttribute("data-start-key",""),document.querySelector(".j-tapd-grap-dialog").style.display="none",r.target=null,r.editor.fire("closeCustomDialog")},n):n()})},e.prototype.openGrapDialog=function(t){t&&this.setDialogVisible(t,!0,t.getAttribute("data-origin-xml"),t.getAttribute("data-graph-token"))},e.prototype.setDialogVisible=function(t,e,a,n){var o=this;void 0===a&&(a=""),void 0===n&&(n="");var i=!1;this.target&&(i=!!this.target.getAttribute("data-start-key"),!e&&i&&this.editor.dom.remove(this.target)),this.dialogVisble=e,this.created&&this.resetDialogSize(),e?(this.target=t,this.createIframe(function(){a&&t?o.beforeParseXML(a,n,function(t){o.updateGrap(t)}):o.updateGrap(a)}),document.querySelector(".j-tapd-grap-dialog").style.display="block",document.querySelector(".j-tapd-grap-dialog .j-dialog-loading").style.display="block"):(document.querySelector(".j-tapd-grap-dialog").style.display="none",!i&&this.target.getAttribute("data-graph-oldxml")&&(this.target.setAttribute("data-origin-xml",this.target.getAttribute("data-graph-oldxml")),this.target.setAttribute("src",this.target.getAttribute("data-graph-oldsrc")),this.target.setAttribute("data-mce-src",this.target.getAttribute("data-graph-oldsrc")),this.target.setAttribute("data-graph-oldxml",""),this.target.setAttribute("data-graph-oldsrc","")),this.target=t)},e.prototype.insertEmptyImg=function(){var t=this.encodeXml(this.generateRandomKey()).replace(/=/g,"");this.editor.insertContent(this.createEmptyGraphImg(t));var e=this.editor.$('img[data-start-key="'+t+'"]');this.openGrapDialog(e[0])},e.prototype.createEmptyGraphImg=function(t){var e=this.editor.getParam("graph_empty_img"),a=this.editor.getParam("graph_empty_xml");return'<img src="'+e+'" data-start-key="'+t+'" alt="tapd-graph" title="\u70b9\u51fb\u56fe\u7247\uff0c\u8fdb\u5165\u56fe\u5f62\u5316\u7f16\u8f91" data-control="tapd-graph" data-origin-xml="'+a+'" data-graph-oldxml="'+a+'">'},e.prototype.createIframe=function(t){var e,a;this.created&&document.querySelector(".j-tapd-grap-dialog")?t():(this.created=!0,(e=document.createElement("style")).innerHTML='\n    img[data-control="tapd-graph"] {\n        cursor: pointer;\n    }\n    .tapd-grap-dialog {\n        position: fixed;\n        left: 0;\n        top: 0;\n        z-index: 9999;\n        width: 100%;\n        height: 100%;\n        text-align: center;\n    }\n    .tapd-grap-dialog--fullscreen .tapd-grap-dialog__content{\n        width: 100%;\n        height: 100%;\n    }\n    .tapd-grap-dialog--fullscreen .tapd-grap-dialog__mask{\n        padding-top: 0;\n    }\n    .tapd-grap-dialog__mask {\n        width: 100%;\n        height: 100%;\n        padding-top: 50px;\n        background-color: rgba(0, 0, 0, .1);\n    }\n    .tapd-grap-dialog__content {\n        width: 80%;\n        height: 80%;\n        margin: 0 auto;\n        background-color: #fff;\n        opacity: 1;\n        border-radius: 3px;\n        border: solid 1px #aab5c1;\n        -moz-box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n        -webkit-box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n        -o-box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n        box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n    }\n    .tapd-grap-dialog__head {\n        padding: 0 18px;\n        height: 43px;\n        line-height: 43px;\n        background-color: transparent;\n        border-bottom: 1px solid #dfe6ee;\n        border-top-right-radius: 3px;\n        border-top-left-radius: 3px;\n        text-align: left;\n    }\n    .tapd-grap-dialog__head .ch-icon:hover {\n        color: #3582fb;\n    }\n    .tapd-grap-dialog__head-title {\n        font-size: 14px;\n        color: #3f4a56;\n    }\n    .tapd-grap-dialog__head-close,\n    .tapd-grap-dialog__head-fullscreen {\n        float: right;\n        margin-left: 15px;\n        color: #8091a5;\n        font-size: 14px;\n        cursor: pointer;\n    }\n    .tapd-grap-dialog .tapd-grap-dialog__head-close{\n        line-height: 44px;\n    }\n    .tapd-grap-dialog__body {\n        position: relative;\n        height: calc(100% - 100px);\n    }\n    .tapd-grap-dialog__body--loading {\n        position: absolute;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: calc(100% - 50px);\n        line-height: 50px;\n        color: #3f4a56;\n        background-color: rgba(255, 255, 255, .5);\n    }\n    .tapd-grap-dialog__body--loading_icon {\n        background-repeat: no-repeat;\n    }\n    .tapd-grap-dialog__foot {\n        height: 55px;\n    }\n    .tapd-grap-dialog__foot-btns {\n        float: right;\n        margin-top: 12px;\n    }\n    .tapd-grap-dialog__foot-btns .foot-btn {\n        display: inline-block;\n        min-width: 60px;\n        height: 30px;\n        line-height: 30px;\n        margin-right: 10px;\n        cursor: pointer;\n        text-decoration: none;\n        outline: 0;\n        border-radius: 2px;\n        text-align: center;\n        vertical-align: middle;\n        font-size: 12px;\n    }\n    .tapd-grap-dialog__foot-btns .foot-btn__ensure {\n        color: #fff;\n        border: 1px solid #3582fb;\n        background-color: #3582fb;\n    }\n    .tapd-grap-dialog__foot-btns .foot-btn__ensure:hover {\n        border: 1px solid #5d9bfc;\n        background-color: #5d9bfc\n    }\n    .tapd-grap-dialog__foot-btns .foot-btn__cancel {\n        margin-right: 25px;\n        color: #3582fb;\n        border: 1px solid #d7e6fe;\n        background-color: #fff;\n    }\n    .tapd-grap-dialog__foot-btns .foot-btn__cancel:hover {\n        color: #5d9bfc;\n        border: 1px solid #5d9bfc;\n        background-color: #fff\n    }\n\n',document.head.appendChild(e),(a=document.createElement("div")).setAttribute("class","tapd-grap-dialog j-tapd-grap-dialog tapd-grap-dialog--normal"),a.style="display:none;",a.innerHTML=n.replace("TAPD_GRAP_URL",this.drawioUrl),document.body.appendChild(a),this.bindEvent(),setTimeout(function(){t()},3e3))},e.prototype.updateGrap=function(t){this.dialogVisble&&(document.getElementById("tapd-grap-dialog-iframe").contentWindow.postMessage({eventName:"INIT_GRAP",value:this.decodeXml(t)},"*"),this.target.getAttribute("data-graph-oldxml")||(this.target.setAttribute("data-graph-oldxml",this.target.getAttribute("data-origin-xml")),this.target.setAttribute("data-graph-oldsrc",this.target.getAttribute("src")),this.target.setAttribute("src",this.editor.getParam("graph_empty_img")),this.target.setAttribute("data-mce-src",this.editor.getParam("graph_empty_img"))))},e.prototype.decodeXml=function(t){return t&&0===t.trim().indexOf("id:")?t:t?decodeURIComponent(escape(window.atob(t))):null},e.prototype.encodeXml=function(t){return t&&0===t.trim().indexOf("id:")?t:window.btoa(unescape(encodeURIComponent(t)))},e.prototype.bindEvent=function(){var e=this;document.querySelector(".j-tapd-grap-dialog")&&(document.querySelector(".j-tapd-grap-dialog .j-foot-btn__ensure").addEventListener("click",function(t){e.onInsertGrap(t),e.editor.fire("showDialogTitle")}),document.querySelectorAll(".j-tapd-grap-dialog .j-close-dialog").forEach(function(t){t.addEventListener("click",function(t){e.editor.fire("showDialogTitle"),e.setDialogVisible(null,!1),e.editor.fire("closeCustomDialog")})}),document.querySelector(".j-tapd-grap-dialog .j-set-dialog-size").addEventListener("click",function(t){var e=document.querySelector(".j-tapd-grap-dialog"),a=t.target.closest(".j-set-dialog-size"),n="";a.getAttribute("fullscreen")?(n=e.getAttribute("class").replace(/tapd-grap-dialog--fullscreen/g,"tapd-grap-dialog--normal"),a.innerHTML=o,a.setAttribute("fullscreen","")):(n=e.getAttribute("class").replace(/tapd-grap-dialog--normal/g,"tapd-grap-dialog--fullscreen"),a.innerHTML='<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M10.2224 6.98322L13.0102 6.98322C13.2863 6.98322 13.5102 7.20708 13.5102 7.48322C13.5102 7.75936 13.2863 7.98322 13.0102 7.98322L9.51016 7.98322C8.95788 7.98322 8.51017 7.53551 8.51016 6.98322L8.51015 3.48322C8.51015 3.20708 8.73401 2.98322 9.01015 2.98322C9.28629 2.98322 9.51015 3.20707 9.51015 3.48322L9.51016 6.28122L12.8612 2.93014C13.0564 2.73488 13.373 2.73487 13.5683 2.93013C13.7636 3.1254 13.7636 3.44198 13.5683 3.63724L10.2224 6.98322Z" fill="#182B50"/>\n<path d="M7.51015 10.0001C7.51015 9.44778 7.06244 9.00006 6.51015 9.00006L3.01015 9.00006C2.73401 9.00006 2.51015 9.22392 2.51015 9.50006C2.51015 9.77621 2.73401 10.0001 3.01015 10.0001L5.75616 10.0001L2.43161 13.3245C2.23634 13.5197 2.23634 13.8363 2.4316 14.0316C2.62685 14.2269 2.94344 14.2269 3.1387 14.0316L6.51015 10.6603L6.51015 13.5001C6.51015 13.7762 6.73401 14.0001 7.01015 14.0001C7.28629 14.0001 7.51015 13.7762 7.51015 13.5001L7.51015 10.0001Z" fill="#182B50"/>\n</svg>',a.setAttribute("fullscreen","1")),e.setAttribute("class",n)}))},e.prototype.resetDialogSize=function(){var t,e,a=document.querySelector(".j-tapd-grap-dialog"),n=a.getAttribute("class");-1<n.indexOf("tapd-grap-dialog--fullscreen")&&(n=n.replace(/tapd-grap-dialog--fullscreen/g,"tapd-grap-dialog--normal"),a.setAttribute("class",n),e=(e=(t=document.querySelector(".j-tapd-grap-dialog .j-set-dialog-size")).getAttribute("class")).replace(/font-editor-fullscreen-restore/g,"font-editor-fullscreen"),t.setAttribute("class",e))},e.prototype.onInsertGrap=function(t){document.getElementById("tapd-grap-dialog-iframe").contentWindow.postMessage({eventName:"GET_GRAP_DATA",value:""},"*")},e.prototype.base64ToFile=function(t,e){for(var a=window.atob(t.split(",")[1]),n=new ArrayBuffer(a.length),o=new Uint8Array(n),i=0;i<a.length;i++)o[i]=a.charCodeAt(i);var r=new Blob([n],{type:"image/png"});return r.lastModifiedDate=new Date,r.name=e,r},e.prototype.beforeInsertXML=function(a,n){var t=this.editor.getParam("graph_before_insert_XML","");t?t(a,function(t,e){t?n("id:"+t,e):n(a)}):n(a)},e.prototype.beforeParseXML=function(e,t,a){var n,o="";e&&0===e.trim().indexOf("id:")?(o=e.trim().replace("id:",""),(n=this.editor.getParam("graph_before_parse_XML",""))?n(o,t,function(t){a(t||e)}):a(e)):a(e)},e.prototype.generateRandomKey=function(){return Math.random().toString(36)},e.prototype.cacheGrap=function(t){this.target.setAttribute("data-origin-xml",this.encodeXml(t)),this.editor.fire("keyup",this.editor)},e);t.add("cherry-draw.io",function(e){e.on("openCustomDialog",function(){e.getBody().setAttribute("contenteditable","false")}),e.on("closeCustomDialog",function(){e.getBody().setAttribute("contenteditable","true")}),e.ui.registry.addIcon("ch-draw.io",'<svg width="20px" height="20px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\nviewBox="0 0 850.394 850.394" enable-background="new 0 0 850.394 850.394" xml:space="preserve">\n<g>\n<g>\n<path fill="#DB8736" d="M850.39,58.74v732.91c0,32.39-25.27,58.74-56.34,58.74H56.35C25.28,850.39,0,824.04,0,791.65V58.74\n C0,26.35,25.28,0,56.35,0h737.7C825.12,0,850.39,26.35,850.39,58.74z"/>\n</g>\n<g>\n<path fill="#CA6F2E" d="M850.39,408.83v382.82c0,32.39-25.27,58.74-56.34,58.74H216.17L89.78,724l147.58-116.94l229.78-432.51\n l102.01-45.57L850.39,408.83z"/>\n</g>\n<path fill="#FFFFFF" d="M740.107,501.646H631.763L515.673,348.747h31.414c16.568,0,30-13.432,30-30V148.668\nc0-16.568-13.432-30-30-30h-243.78c-16.568,0-30,13.432-30,30v170.079c0,16.568,13.432,30,30,30h32.887L217.442,501.646H110.286\nc-16.568,0-30,13.432-30,30v170.079c0,16.568,13.432,30,30,30h243.78c16.568,0,30-13.432,30-30V531.646c0-16.568-13.432-30-30-30\nh-60.653l118.752-152.899h28.173l116.09,152.899h-60.1c-16.568,0-30,13.432-30,30v170.079c0,16.568,13.432,30,30,30h243.779\nc16.568,0,30-13.432,30-30V531.646C770.107,515.078,756.676,501.646,740.107,501.646z"/>\n</g>\n</svg>'),e.ui.registry.addButton("ch-drawio",{icon:"ch-draw.io",tooltip:"Draw.io",onAction:function(){a.init(e),a.insertEmptyImg(),e.fire("openCustomDialog")},onSetup:function(){return e.on("click",function(t){"tapd-graph"===t.target.getAttribute("data-control")&&(a.init(e),a.openGrapDialog(t.target),e.fire("openCustomDialog"))}),function(){}}})})}();