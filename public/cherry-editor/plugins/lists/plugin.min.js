!function(){"use strict";var e,t,n,r,o,i,u,a=tinymce.util.Tools.resolve("tinymce.PluginManager"),s=function(){},y=function(e){return function(){return e}},c=function(t){return function(e){return!t(e)}},f=y(!1),d=y(!0),l=function(){return m},m=(e=function(e){return e.isNone()},{fold:function(e,t){return e()},is:f,isSome:f,isNone:d,getOr:n=function(e){return e},getOrThunk:t=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:y(null),getOrUndefined:y(undefined),or:n,orThunk:t,map:l,each:s,bind:l,exists:f,forall:d,filter:l,equals:e,equals_:e,toArray:function(){return[]},toString:y("none()")}),p=function(n){var e=y(n),t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:d,isNone:f,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return p(e(n))},each:function(e){e(n)},bind:r,exists:r,forall:r,filter:function(e){return e(n)?o:m},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(f,function(e){return t(n,e)})}};return o},g={some:p,none:l,from:function(e){return null===e||e===undefined?m:p(e)}},v=function(r){return function(e){return n=typeof(t=e),(null===t?"null":"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n)===r;var t,n}},h=function(t){return function(e){return typeof e===t}},S=v("string"),b=v("array"),C=h("boolean"),N=h("function"),O=h("number"),L=Array.prototype.slice,T=Array.prototype.push,k=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o)}return r},D=function(e,t){for(var n=0,r=e.length;n<r;n++){t(e[n],n)}},w=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r)&&n.push(i)}return n},x=function(e,t,n){return D(e,function(e){n=t(n,e)}),n},A=function(e,t,n){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(t(i,r))return g.some(i);if(n(i,r))break}return g.none()},E=function(e,t){return A(e,t,f)},P=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!b(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);T.apply(t,e[n])}return t}(k(e,t))},B=function(e){var t=L.call(e,0);return t.reverse(),t},R=function(e,t){return 0<=t&&t<e.length?g.some(e[t]):g.none()},I=function(e){return R(e,0)},M=function(e){return R(e,e.length-1)},U=function(){return(U=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},_=function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}return undefined}(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return H(r(1),r(2))},F=function(){return H(0,0)},H=function(e,t){return{major:e,minor:t}},$={nu:H,detect:function(e,t){var n=String(t).toLowerCase();return 0===e.length?F():_(e,n)},unknown:F},q=function(e,t){var n=String(t).toLowerCase();return E(e,function(e){return e.search(n)})},j=function(e,n){return q(e,n).map(function(e){var t=$.detect(e.versionRegexes,n);return{current:e.name,version:t}})},K=function(e,n){return q(e,n).map(function(e){var t=$.detect(e.versionRegexes,n);return{current:e.name,version:t}})},V=function(e,t){return-1!==e.indexOf(t)},W=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Q=function(t){return function(e){return V(e,t)}},X=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return V(e,"edge/")&&V(e,"chrome")&&V(e,"safari")&&V(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,W],search:function(e){return V(e,"chrome")&&!V(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return V(e,"msie")||V(e,"trident")}},{name:"Opera",versionRegexes:[W,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Q("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Q("firefox")},{name:"Safari",versionRegexes:[W,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(V(e,"safari")||V(e,"mobile/"))&&V(e,"applewebkit")}}],z=[{name:"Windows",search:Q("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return V(e,"iphone")||V(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Q("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Q("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Q("linux"),versionRegexes:[]},{name:"Solaris",search:Q("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Q("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Q("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Y={browsers:y(X),oses:y(z)},G="Edge",J="Firefox",Z=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isEdge:r(G),isChrome:r("Chrome"),isIE:r("IE"),isOpera:r("Opera"),isFirefox:r(J),isSafari:r("Safari")}},ee={unknown:function(){return Z({current:undefined,version:$.unknown()})},nu:Z,edge:y(G),chrome:y("Chrome"),ie:y("IE"),opera:y("Opera"),firefox:y(J),safari:y("Safari")},te="Windows",ne="Android",re="Solaris",oe="FreeBSD",ie="ChromeOS",ue=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isWindows:r(te),isiOS:r("iOS"),isAndroid:r(ne),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r(re),isFreeBSD:r(oe),isChromeOS:r(ie)}},ae={unknown:function(){return ue({current:undefined,version:$.unknown()})},nu:ue,windows:y(te),ios:y("iOS"),android:y(ne),linux:y("Linux"),osx:y("OSX"),solaris:y(re),freebsd:y(oe),chromeos:y(ie)},se=function(e,t){var n,r,o,i,u,a,s,c,f,d,l,m,p=Y.browsers(),g=Y.oses(),v=j(p,e).fold(ee.unknown,ee.nu),h=K(g,e).fold(ae.unknown,ae.nu);return{browser:v,os:h,deviceType:(r=v,o=e,i=t,u=(n=h).isiOS()&&!0===/ipad/i.test(o),a=n.isiOS()&&!u,s=n.isiOS()||n.isAndroid(),c=s||i("(pointer:coarse)"),f=u||!a&&s&&i("(min-device-width:768px)"),d=a||s&&!f,l=r.isSafari()&&n.isiOS()&&!1===/safari/i.test(o),m=!d&&!f&&!l,{isiPad:y(u),isiPhone:y(a),isTablet:y(f),isPhone:y(d),isTouch:y(c),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:y(l),isDesktop:y(m)})}},ce=function(e){return window.matchMedia(e).matches},fe=(i=!(r=function(){return se(navigator.userAgent,ce)}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i||(i=!0,o=r.apply(null,e)),o}),de=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:e}},le={fromHtml:function(e,t){var n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||1<n.childNodes.length)throw console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return de(n.childNodes[0])},fromTag:function(e,t){var n=(t||document).createElement(e);return de(n)},fromText:function(e,t){var n=(t||document).createTextNode(e);return de(n)},fromDom:de,fromPoint:function(e,t,n){return g.from(e.dom.elementFromPoint(t,n)).map(de)}},me=function(e,t){return e.dom===t.dom},pe=function(e,t){return n=e.dom,r=t.dom,o=n,i=r,u=Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(o.compareDocumentPosition(i)&u);var n,r,o,i,u},ge=function(e,t){return fe().browser.isIE()?pe(e,t):(n=t,r=e.dom,o=n.dom,r!==o&&r.contains(o));var n,r,o},ve=function(e,t){var n=e.dom;if(1!==n.nodeType)return!1;var r=n;if(r.matches!==undefined)return r.matches(t);if(r.msMatchesSelector!==undefined)return r.msMatchesSelector(t);if(r.webkitMatchesSelector!==undefined)return r.webkitMatchesSelector(t);if(r.mozMatchesSelector!==undefined)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},he=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),ye=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Se=tinymce.util.Tools.resolve("tinymce.util.VK"),be=Object.keys,Ce=function(e,t){for(var n=be(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i)}},Ne=function(e,t){var n,r,o,i,u={};return n=t,i=u,r=function(e,t){i[t]=e},o=s,Ce(e,function(e,t){(n(e,t)?r:o)(e,t)}),u},Oe=("undefined"!=typeof window||Function("return this;")(),function(e){return e.dom.nodeName.toLowerCase()}),Le=(u=1,function(e){return e.dom.nodeType===u}),Te=function(e,t){var n=e.dom;Ce(t,function(e,t){!function(e,t,n){if(!(S(n)||C(n)||O(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")}(n,t,e)})},ke=function(e){return x(e.dom.attributes,function(e,t){return e[t.name]=t.value,e},{})},De=function(e){return g.from(e.dom.parentNode).map(le.fromDom)},we=function(e){return k(e.dom.childNodes,le.fromDom)},xe=function(e,t){var n=e.dom.childNodes;return g.from(n[t]).map(le.fromDom)},Ae=function(e){return xe(e,0)},Ee=function(e){return xe(e,e.dom.childNodes.length-1)},Pe=function(t,n){De(t).each(function(e){e.dom.insertBefore(n.dom,t.dom)})},Be=function(e,t){e.dom.appendChild(t.dom)},Re=function(t,e){D(e,function(e){Be(t,e)})},Ie=function(e){var t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},Me=function(e){return t=e,n=!0,le.fromDom(t.dom.cloneNode(n));var t,n},Ue=function(e,t){var n,r,o,i,u=(n=e,r=t,o=le.fromTag(r),i=ke(n),Te(o,i),o);Pe(e,u);var a=we(e);return Re(u,a),Ie(e),u},_e=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Fe=tinymce.util.Tools.resolve("tinymce.util.Tools"),He=function(t){return function(e){return e&&e.nodeName.toLowerCase()===t}},$e=function(t){return function(e){return e&&t.test(e.nodeName)}},qe=function(e){return e&&3===e.nodeType},je=$e(/^(OL|UL|DL)$/),Ke=$e(/^(OL|UL)$/),Ve=He("ol"),We=$e(/^(LI|DT|DD)$/),Qe=$e(/^(DT|DD)$/),Xe=$e(/^(TH|TD)$/),ze=He("br"),Ye=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},Ge=function(e,t){return e&&e.nodeName in t},Je=function(e,t,n){var r=e.isEmpty(t);return!(n&&0<e.select("span[data-mce-type=bookmark]",t).length)&&r},Ze=function(e,t){return e.isChildOf(t,e.getRoot())},et=function(e,t){var n,r,o,i,u=e.dom,a=e.schema.getBlockElements(),s=u.createFragment(),c=!1===(n=e.getParam("forced_root_block","p"))?"":!0===n?"p":n;if(c&&((o=u.create(c)).tagName===c.toUpperCase()&&u.setAttribs(o,e.getParam("forced_root_block_attrs",{})),Ge(t.firstChild,a)||s.appendChild(o)),t)for(;r=t.firstChild;){var f=r.nodeName;i||"SPAN"===f&&"bookmark"===r.getAttribute("data-mce-type")||(i=!0),Ge(r,a)?(s.appendChild(r),o=null):c?(o||(o=u.create(c),s.appendChild(o)),o.appendChild(r)):s.appendChild(r)}return c?i||o.appendChild(u.create("br",{"data-mce-bogus":"1"})):s.appendChild(u.create("br")),s},tt=_e.DOM,nt=function(t,n){ve(n,"dd")?Ue(n,"dt"):ve(n,"dt")&&De(n).each(function(e){return function(e,t,n){var r=tt.select('span[data-mce-type="bookmark"]',t),o=et(e,n),i=tt.createRng();i.setStartAfter(n),i.setEndAfter(t);for(var u,a=i.extractContents(),s=a.firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&e.dom.isEmpty(s)){tt.remove(s);break}e.dom.isEmpty(a)||tt.insertAfter(a,t),tt.insertAfter(o,t),Je(e.dom,n.parentNode)&&(u=n.parentNode,Fe.each(r,function(e){u.parentNode.insertBefore(e,n.parentNode)}),tt.remove(u)),tt.remove(n),Je(e.dom,t)&&tt.remove(t)}(t,e.dom,n.dom)})},rt=function(e){ve(e,"dt")&&Ue(e,"dd")},ot=function(e,t){if(qe(e))return{container:e,offset:t};var n=he.getNode(e,t);return qe(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&qe(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&qe(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},it=function(e){var t=e.cloneRange(),n=ot(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var r=ot(e.endContainer,e.endOffset);return t.setEnd(r.container,r.offset),t},ut=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),at=function(e,t){var n=t||e.selection.getStart(!0);return e.dom.getParent(n,"OL,UL,DL",ft(e,n))},st=function(e){var t,n,r,o=at(e),i=e.selection.getSelectedBlocks();return r=i,(n=o)&&1===r.length&&r[0]===n?(t=o,Fe.grep(t.querySelectorAll("ol,ul,dl"),function(e){return je(e)})):Fe.grep(i,function(e){return je(e)&&o!==e})},ct=function(e){var n,t,r,o=e.selection.getSelectedBlocks();return Fe.grep((n=e,t=o,r=Fe.map(t,function(e){var t=n.dom.getParent(e,"li,dd,dt",ft(n,e));return t||e}),ut.unique(r)),function(e){return We(e)})},ft=function(e,t){var n=e.dom.getParents(t,"TD,TH");return 0<n.length?n[0]:e.getBody()},dt=function(e,t){var n=e.dom.getParents(t,"ol,ul",ft(e,t));return M(n)},lt=function(e){var t,n,r,o=(n=dt(t=e,t.selection.getStart()),r=w(t.selection.getSelectedBlocks(),Ke),n.toArray().concat(r));return mt(e,o)},mt=function(t,e){var n=k(e,function(e){return dt(t,e).getOr(e)});return ut.unique(n)},pt=function(e,t,n){return e.isSome()&&t.isSome()?g.some(n(e.getOrDie(),t.getOrDie())):g.none()},gt=function(e,t,n){return e.fire("ListMutation",{action:t,element:n})},vt=function(e,t,n){if(!S(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);var r;(r=e).style!==undefined&&N(r.style.getPropertyValue)&&(e.style.setProperty(t,n),"TR"===e.nodeName&&e.getAttribute("data-mce-style")&&e.removeAttribute("data-mce-style"))},ht=function(e,t){Be(e.item,t.list)},yt=function(e,t,n){for(var r,o,i,u=[],a=0;a<n;a++)u.push((r=e,o=t.listType,i={list:le.fromTag(o,r),item:le.fromTag("li",r)},Be(i.list,i.item),i));return u},St=function(e,t){for(var n,r,o,i,u=0;u<e.length-1;u++)n=e[u].item,r="list-style-type",o="none",i=n.dom,vt(i,r,o);M(e).each(function(e){Te(e.list,t.listAttributes),Te(e.item,t.itemAttributes),Re(e.item,t.content)})},bt=function(f,e,d){var t=e.slice(0,d.depth);return M(t).each(function(e){var t,n,r,o,i,u,a,s,c=(t=f,n=d.itemAttributes,r=d.content,o=le.fromTag("li",t),Te(o,n),Re(o,r),o);u=c,Be((i=e).list,u),i.item=u,s=d,Oe((a=e).list)!==s.listType&&(a.list=Ue(a.list,s.listType)),Te(a.list,s.listAttributes)}),t},Ct=function(e,t,n){var r,o=yt(e,n,n.depth-t.length);return function(e){for(var t=1;t<e.length;t++)ht(e[t-1],e[t])}(o),St(o,n),r=o,pt(M(t),I(r),ht),t.concat(o)},Nt=function(e){return ve(e,"OL,UL")},Ot=function(e){return Ae(e).map(Nt).getOr(!1)},Lt=function(e){return 0<e.depth},Tt=function(e){return e.isSelected},kt=function(e){var t=we(e),n=Ee(e).map(Nt).getOr(!1)?t.slice(0,-1):t;return k(n,Me)},Dt=function(a){return D(a,function(r,e){var t,n,o,i,u;o=(t=a)[n=e].depth,i=function(e){return e.depth===o&&!e.dirty},u=function(e){return e.depth<o},A(B(t.slice(0,n)),i,u).orThunk(function(){return A(t.slice(n+1),i,u)}).fold(function(){var e;r.dirty&&((e=r).listAttributes=Ne(e.listAttributes,function(e,t){return"start"!==t}))},function(e){return n=e,(t=r).listType=n.listType,void(t.listAttributes=U({},n.listAttributes));var t,n})}),a},wt=function(i,u,a,s){return Ae(s).filter(Nt).fold(function(){u.each(function(e){me(e.start,s)&&a.set(!0)});var t,n,r,e=(t=s,n=i,r=a.get(),De(t).filter(Le).map(function(e){return{depth:n,dirty:!1,isSelected:r,content:kt(t),itemAttributes:ke(t),listAttributes:ke(e),listType:Oe(e)}}));u.each(function(e){me(e.end,s)&&a.set(!1)});var o=Ee(s).filter(Nt).map(function(e){return xt(i,u,a,e)}).getOr([]);return e.toArray().concat(o)},function(e){return xt(i,u,a,e)})},xt=function(t,n,r,e){return P(we(e),function(e){return(Nt(e)?xt:wt)(t+1,n,r,e)})},At=function(e,t){var n,r=(n=!1,{get:function(){return n},set:function(e){n=e}});return k(e,function(e){return{sourceList:e,entries:xt(0,t,r,e)}})},Et=function(i,e){var t=Dt(e);return k(t,function(e){var t,n,r,o=(t=e.content,r=(n||document).createDocumentFragment(),D(t,function(e){r.appendChild(e.dom)}),le.fromDom(r));return le.fromDom(et(i,o.dom))})},Pt=function(e,t){var n,r,o=Dt(t);return n=e.contentDocument,r=x(o,function(e,t){return(t.depth>e.length?Ct:bt)(n,e,t)},[]),I(r).map(function(e){return e.list}).toArray()},Bt=function(a,e,s){var t,n=At(e,(t=k(ct(a),le.fromDom),pt(E(t,c(Ot)),E(B(t),c(Ot)),function(e,t){return{start:e,end:t}})));D(n,function(e){var t,n;t=e.entries,n=s,D(w(t,Tt),function(e){return function(e,t){switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}t.dirty=!0}(n,e),0});var r,o,i,u=(r=a,o=e.entries,P(function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var a=e[i],s=t(a);s!==n&&(r.push(o),o=[]),n=s,o.push(a)}return 0!==o.length&&r.push(o),r}(o,Lt),function(e){return(I(e).map(Lt).getOr(!1)?Pt:Et)(r,e)}));D(u,function(e){gt(a,"Indent"===s?"IndentList":"OutdentList",e.dom)}),i=e.sourceList,D(u,function(e){Pe(i,e)}),Ie(e.sourceList)})},Rt=function(e,t){var n,r,o=k(lt(e),le.fromDom),i=k(w(ct(e),Qe),le.fromDom),u=!1;return(o.length||i.length)&&(n=e.selection.getBookmark(),Bt(e,o,t),r=e,D(i,"Indent"===t?rt:function(e){return nt(r,e),0}),e.selection.moveToBookmark(n),e.selection.setRng(it(e.selection.getRng())),e.nodeChanged(),u=!0),u},It=function(e){return Rt(e,"Indent")},Mt=function(e){return Rt(e,"Outdent")},Ut=function(e){return Rt(e,"Flatten")},_t=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),Ft=_e.DOM,Ht=function(o){var i={},e=function(e){var t,n=o[e?"startContainer":"endContainer"],r=o[e?"startOffset":"endOffset"];1===n.nodeType&&(t=Ft.create("span",{"data-mce-type":"bookmark"}),n.hasChildNodes()?(r=Math.min(r,n.childNodes.length-1),e?n.insertBefore(t,n.childNodes[r]):Ft.insertAfter(t,n.childNodes[r])):n.appendChild(t),n=t,r=0),i[e?"startContainer":"endContainer"]=n,i[e?"startOffset":"endOffset"]=r};return e(!0),o.collapsed||e(),i},$t=function(o){function e(e){var t,n=t=o[e?"startContainer":"endContainer"],r=o[e?"startOffset":"endOffset"];n&&(1===n.nodeType&&(r=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(n),n=n.parentNode,Ft.remove(t),!n.hasChildNodes()&&Ft.isBlock(n)&&n.appendChild(Ft.create("br"))),o[e?"startContainer":"endContainer"]=n,o[e?"startOffset":"endOffset"]=r)}e(!0),e();var t=Ft.createRng();return t.setStart(o.startContainer,o.startOffset),o.endContainer&&t.setEnd(o.endContainer,o.endOffset),it(t)},qt=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},jt=function(e){return/\btox\-/.test(e.className)},Kt=function(e,n,r){var t=function(e){var t=A(e.parents,je,Xe).filter(function(e){return e.nodeName===n&&!jt(e)}).isSome();r(t)},o=e.dom.getParents(e.selection.getNode());return t({parents:o}),e.on("NodeChange",t),function(){return e.off("NodeChange",t)}},Vt=function(e,r){return function o(e){var t=!1;if(!e)return!1;{if("A"===e.nodeName&&e.getAttribute("is-tapdlink")&&-1<r.indexOf(e.getAttribute("mode")))return!0;if("A"!==e.nodeName){var n=e.querySelectorAll('a[is-tapdlink="true"]');if(!n.length)return!1;n.forEach(function(e){t=t||o(e)})}}return t}(e.selection.getNode())||!1},Wt=function(n,e){Fe.each(e,function(e,t){n.setAttribute(t,e)})},Qt=function(e,t,n){var r,o,i,u,a,s,c;r=e,o=t,u=(i=n)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",u),a=e,Wt(s=t,(c=n)["list-attributes"]),Fe.each(a.select("li",s),function(e){Wt(e,c["list-item-attributes"])})},Xt=function(e,t,n,r){var o=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"];for(1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&ze(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(Ye(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},zt=function(f,d,l){void 0===l&&(l={});var e,t=f.selection.getRng(),m="LI",n=ft(f,f.selection.getStart(!0)),p=f.dom;"false"!==p.getContentEditable(f.selection.getNode())&&("DL"===(d=d.toUpperCase())&&(m="DT"),e=Ht(t),Fe.each(function(n,e,r){for(var o,i=[],u=n.dom,t=Xt(n,e,!0,r),a=Xt(n,e,!1,r),s=[],c=t;c&&(s.push(c),c!==a);c=c.nextSibling);return Fe.each(s,function(e){if(Ye(n,e))return i.push(e),void(o=null);if(u.isBlock(e)||ze(e))return ze(e)&&u.remove(e),void(o=null);var t=e.nextSibling;_t.isBookmarkNode(e)&&(Ye(n,t)||!t&&e.parentNode===r)?o=null:(o||(o=u.create("p"),e.parentNode.insertBefore(o,e),i.push(o)),o.appendChild(e))}),i}(f,t,n),function(e){var t,n,r,o,i,u,a,s,c=e.previousSibling;c&&je(c)&&c.nodeName===d&&(n=c,r=l,o=p.getStyle(n,"list-style-type"),i=r?r["list-style-type"]:"",o===(i=null===i?"":i))?(t=c,e=p.rename(e,m),c.appendChild(e)):(t=p.create(d),e.parentNode.insertBefore(t,e),t.appendChild(e),e=p.rename(e,m)),u=p,a=e,s=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],Fe.each(s,function(e){var t;return u.setStyle(a,((t={})[e]="",t))}),Qt(p,t,l),Gt(f.dom,t)}),f.selection.setRng($t(e)))},Yt=function(e,t,n){return s=n,(a=t)&&s&&je(a)&&a.nodeName===s.nodeName&&(i=t,u=n,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(u,"list-style-type",!0))&&(r=n,t.className===r.className);var r,o,i,u,a,s},Gt=function(e,t){var n,r=t.nextSibling;if(Yt(e,t,r)){for(;n=r.firstChild;)t.appendChild(n);e.remove(r)}if(r=t.previousSibling,Yt(e,t,r)){for(;n=r.lastChild;)t.insertBefore(n,t.firstChild);e.remove(r)}},Jt=function(u,e,t,a,s){var n;e.nodeName!==a||Zt(s)?(n=Ht(u.selection.getRng(!0)),Fe.each([e].concat(t),function(e){var t,n,r,o,i;Vt(u,["card"])||(t=u,r=a,o=s,(n=e).nodeName!==r?(i=t.dom.rename(n,r),Qt(t.dom,i,o),gt(t,qt(r),i)):(Qt(t.dom,n,o),gt(t,qt(r),n)))}),u.selection.setRng($t(n))):Ut(u)},Zt=function(e){return"list-style-type"in e},en=function(e,t,n){var r,o,i,u,a,s,c=at(e),f=st(e);if(n=n||{},c&&0<f.length)Jt(e,c,f,t,n);else{if(Vt(e,["card"]))return;i=t,u=n,(o=c)!==(r=e).getBody()&&(o?o.nodeName!==i||Zt(u)||jt(o)?(a=Ht(r.selection.getRng(!0)),Qt(r.dom,o,u),s=r.dom.rename(o,i),Gt(r.dom,s),r.selection.setRng($t(a)),gt(r,qt(i),s)):Ut(r):(zt(r,i,u),gt(r,qt(i),o)))}},tn=_e.DOM,nn=function(i,e){Fe.each(Fe.grep(i.select("ol,ul",e)),function(e){var t,n,r,o;t=i,"LI"===(o=(n=e).parentNode).nodeName&&o.firstChild===n&&((r=o.previousSibling)&&"LI"===r.nodeName?(r.appendChild(n),Je(t,o)&&tn.remove(o)):tn.setStyle(o,"listStyleType","none")),je(o)&&(r=o.previousSibling)&&"LI"===r.nodeName&&r.appendChild(n)})},rn=function(e,t,n,r){var o=t.startContainer,i=t.startOffset;if(qe(o)&&(n?i<o.data.length:0<i))return o;var u=e.schema.getNonEmptyElements();1===o.nodeType&&(o=he.getNode(o,i));var a,s,c=new ye(o,r);for(n&&(a=e.dom,ze(s=o)&&a.isBlock(s.nextSibling)&&!ze(s.previousSibling)&&c.next());o=c[n?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(u[o.nodeName])return o;if(qe(o)&&0<o.data.length)return o}},on=function(e,t){var n=t.childNodes;return 1===n.length&&!je(n[0])&&e.isBlock(n[0])},un=function(e,t,n){var r,o,i,u=on(e,n)?n.firstChild:n;if(on(o=e,i=t)&&o.remove(i.firstChild,!0),!Je(e,t,!0))for(;r=t.firstChild;)u.appendChild(r)},an=function(t,e,n){var r,o,i,u=e.parentNode;Ze(t,e)&&Ze(t,n)&&(je(n.lastChild)&&(r=n.lastChild),u===n.lastChild&&ze(u.previousSibling)&&t.remove(u.previousSibling),(o=n.lastChild)&&ze(o)&&e.hasChildNodes()&&t.remove(o),Je(t,n,!0)&&t.$(n).empty(),un(t,e,n),r&&n.appendChild(r),i=ge(le.fromDom(n),le.fromDom(e))?t.getParents(e,je,n):[],t.remove(e),D(i,function(e){Je(t,e)&&e!==t.getRoot()&&t.remove(e)}))},sn=function(e,t,n,r){var o,i,u,a,s=e.dom;s.isEmpty(r)?(u=n,a=r,(i=e).dom.$(a).empty(),an(i.dom,u,a),i.selection.setCursorLocation(a)):(o=Ht(t),an(s,n,r),e.selection.setRng($t(o)))},cn=function(t,n){var e=t.dom,r=t.selection,o=r.getStart(),i=ft(t,o),u=e.getParent(r.getStart(),"LI",i);if(u){var a=u.parentNode;if(a===t.getBody()&&Je(e,a))return!0;var s=it(r.getRng()),c=e.getParent(rn(t,s,n,i),"LI",i);if(c&&c!==u)return t.undoManager.transact(function(){var e;n?sn(t,s,c,u):(e=u).parentNode.firstChild===e?Mt(t):function(e,t,n,r){var o=Ht(t);an(e.dom,n,r);var i=$t(o);e.selection.setRng(i)}(t,s,u,c)}),!0;if(!c&&!n&&0===s.startOffset&&0===s.endOffset)return t.undoManager.transact(function(){Ut(t)}),!0}return!1},fn=function(o,i){var u=o.dom,e=o.selection.getStart(),a=ft(o,e),s=u.getParent(e,u.isBlock,a);if(s&&u.isEmpty(s)){var t=it(o.selection.getRng()),c=u.getParent(rn(o,t,i,a),"LI",a);if(c)return o.undoManager.transact(function(){var e,t,n,r;t=s,n=a,r=(e=u).getParent(t.parentNode,e.isBlock,n),e.remove(t),r&&e.isEmpty(r)&&e.remove(r),Gt(u,c.parentNode),o.selection.select(c,!0),o.selection.collapse(i)}),!0}return!1},dn=function(e,t){return e.selection.isCollapsed()?cn(i=e,u=t)||fn(i,u):(r=(n=e).selection.getStart(),o=ft(n,r),!!(n.dom.getParent(r,"LI,DT,DD",o)||0<ct(n).length)&&(n.undoManager.transact(function(){n.execCommand("Delete"),nn(n.dom,n.getBody())}),!0));var n,r,o,i,u},ln=function(n){var r=n.dom,e=at(n);Ve(e)&&n.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:r.getAttrib(e,"start")||"1"},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(e){var t=e.getData();n.undoManager.transact(function(){r.setAttrib(at(n),"start","1"===t.start?"":t.start)}),e.close()}})},mn=function(t,n){return function(){var e=t.dom.getParent(t.selection.getStart(),"UL,OL,DL");return e&&e.nodeName===n}},pn=function(e){var t,n;e.getParam("lists_indent_on_tab",!0)&&(t=e).on("keydown",function(e){e.keyCode!==Se.TAB||Se.metaKeyPressed(e)||t.undoManager.transact(function(){(e.shiftKey?Mt:It)(t)&&e.preventDefault()})}),(n=e).on("keydown",function(e){e.keyCode===Se.BACKSPACE?dn(n,!1)&&e.preventDefault():e.keyCode===Se.DELETE&&dn(n,!0)&&e.preventDefault()})};a.add("lists",function(e){var n,t,r,o,i,u;return!1===e.hasPlugin("rtc",!0)&&(pn(e),(n=e).on("BeforeExecCommand",function(e){var t=e.command.toLowerCase();"indent"===t?It(n):"outdent"===t&&Mt(n)}),n.addCommand("InsertUnorderedList",function(e,t){en(n,"UL",t)}),n.addCommand("InsertOrderedList",function(e,t){en(n,"OL",t)}),n.addCommand("InsertDefinitionList",function(e,t){en(n,"DL",t)}),n.addCommand("RemoveList",function(){Ut(n)}),n.addCommand("mceListProps",function(){ln(n)}),n.addQueryStateHandler("InsertUnorderedList",mn(n,"UL")),n.addQueryStateHandler("InsertOrderedList",mn(n,"OL")),n.addQueryStateHandler("InsertDefinitionList",mn(n,"DL"))),r=function(e){return function(){return t.execCommand(e)}},(t=e).hasPlugin("advlist")||(t.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:r("InsertOrderedList"),onSetup:function(e){return Kt(t,"OL",e.setActive)}}),t.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:r("InsertUnorderedList"),onSetup:function(e){return Kt(t,"UL",e.setActive)}})),i={text:"List properties...",icon:"ordered-list",onAction:function(){return ln(o)},onSetup:function(t){return Kt(o,"OL",function(e){return t.setDisabled(!e)})}},(o=e).ui.registry.addMenuItem("listprops",i),o.ui.registry.addContextMenu("lists",{update:function(e){var t=at(o,e);return Ve(t)?["listprops"]:[]}}),u=e,{backspaceDelete:function(e){dn(u,e)}}})}();